


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QLD Business Development Report - All 77 LGAs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <style>
        :root {
            --qld-maroon: #771414;
            --qld-gold: #FFCD00;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f0;
            background-image: radial-gradient(at 0% 0%, rgba(119, 20, 20, 0.03) 0px, transparent 50%);
        }
        
        h1, h2, h3, .display-font {
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .region-card {
            background: linear-gradient(135deg, #ffffff 0%, #fafafa 100%);
            border-left: 4px solid var(--qld-maroon);
        }
        
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .sync-indicator {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        .priority-high { border-left-color: #dc2626; }
        .priority-medium { border-left-color: #f59e0b; }
        .priority-low { border-left-color: #10b981; }
        
        .offline-banner {
            background: linear-gradient(90deg, #f59e0b, #d97706);
            color: white;
            transform: translateY(-100%);
            transition: transform 0.3s;
        }
        
        .offline-banner.show {
            transform: translateY(0);
        }
        
        /* Custom scrollbar for region list */
        .region-scroll::-webkit-scrollbar {
            height: 6px;
        }
        
        .region-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .region-scroll::-webkit-scrollbar-thumb {
            background: #771414;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        .toast {
            transform: translateX(120%);
            transition: transform 0.3s ease-out;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--qld-maroon), var(--qld-gold));
        }
        
        .region-group {
            background: linear-gradient(135deg, #fafafa 0%, #f0f0f0 100%);
            border: 1px solid #e5e7eb;
        }
    </style>
</head>
<body class="text-gray-800 min-h-screen">

    <!-- Offline Warning -->
    <div id="offlineBanner" class="offline-banner fixed top-0 left-0 right-0 z-50 px-4 py-2 text-center text-sm font-medium">
        <i class="fas fa-wifi-slash mr-2"></i> You're offline. Changes will sync when you reconnect.
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl max-w-md w-full p-8 shadow-2xl">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-br from-[#771414] to-[#9f1c1c] rounded-full flex items-center justify-center text-white text-2xl mx-auto mb-4">
                    <i class="fas fa-building"></i>
                </div>
                <h2 class="text-2xl font-bold display-font">QLD Business Report</h2>
                <p class="text-gray-500 mt-2">All 77 Local Government Areas</p>
                <p class="text-xs text-gray-400 mt-1">Sign in to access your data</p>
            </div>
            
            <div id="authForm">
                <input type="email" id="authEmail" placeholder="Email address" class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 mb-3 focus:border-[#771414] focus:outline-none">
                <input type="password" id="authPassword" placeholder="Password" class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 mb-4 focus:border-[#771414] focus:outline-none">
                
                <button onclick="signIn()" class="w-full py-3 bg-[#771414] text-white rounded-lg font-medium hover:bg-[#5a1010] transition-colors mb-3">
                    Sign In
                </button>
                
                <button onclick="signUp()" class="w-full py-3 border-2 border-[#771414] text-[#771414] rounded-lg font-medium hover:bg-red-50 transition-colors">
                    Create Account
                </button>
                
                <p class="text-xs text-center text-gray-400 mt-4">
                    Demo mode available without registration
                </p>
            </div>
        </div>
    </div>

    <!-- Main App (Hidden until auth) -->
    <div id="mainApp" class="hidden">
        
        <!-- Navigation -->
        <nav class="glass-panel sticky top-0 z-40 border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16 items-center">
                    <div class="flex items-center space-x-4">
                        <div class="w-10 h-10 bg-gradient-to-br from-[#771414] to-[#9f1c1c] rounded-lg flex items-center justify-center text-white font-bold text-xl shadow-lg">
                            QLD
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900 display-font tracking-tight">Business Development Report</h1>
                            <div class="flex items-center space-x-2 text-xs text-gray-500">
                                <span id="userEmail"></span>
                                <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                                <span id="syncStatus" class="flex items-center text-green-600">
                                    <i class="fas fa-check-circle mr-1"></i> Synced
                                </span>
                                <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                                <span class="text-[#771414] font-semibold">77 LGAs</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <button onclick="exportToExcel()" class="hidden md:flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors shadow-sm">
                            <i class="fas fa-file-excel mr-2"></i> Export Excel
                        </button>
                        
                        <button onclick="shareReport()" class="hidden md:flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors shadow-sm">
                            <i class="fas fa-share-alt mr-2"></i> Share
                        </button>
                        
                        <button onclick="signOut()" class="px-4 py-2 text-gray-600 hover:text-gray-900 text-sm font-medium">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                        
                        <div class="relative">
                            <input type="text" id="globalSearch" placeholder="Search all 77 LGAs..." 
                                   class="pl-10 pr-4 py-2 rounded-full bg-gray-100 border-none focus:ring-2 focus:ring-[#771414] w-56 text-sm"
                                   onkeyup="globalSearch()">
                            <i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- Dashboard Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="stat-card rounded-xl p-6 shadow-sm">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm font-medium text-gray-600 mb-1">Active Tenders</p>
                            <h3 class="text-3xl font-bold text-gray-900" id="statActiveTenders">-</h3>
                        </div>
                        <div class="p-2 bg-red-50 rounded-lg">
                            <i class="fas fa-file-contract text-[#771414] text-xl"></i>
                        </div>
                    </div>
                    <p class="text-xs text-green-600 mt-2 flex items-center">
                        <i class="fas fa-sync-alt mr-1 sync-indicator"></i> Live updates
                    </p>
                </div>
                
                <div class="stat-card rounded-xl p-6 shadow-sm">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm font-medium text-gray-600 mb-1">Awarded Works</p>
                            <h3 class="text-3xl font-bold text-gray-900" id="statAwarded">-</h3>
                        </div>
                        <div class="p-2 bg-yellow-50 rounded-lg">
                            <i class="fas fa-award text-yellow-600 text-xl"></i>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Total: <span class="font-semibold" id="statTotalValue">-</span></p>
                </div>
                
                <div class="stat-card rounded-xl p-6 shadow-sm">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm font-medium text-gray-600 mb-1">Local Contacts</p>
                            <h3 class="text-3xl font-bold text-gray-900" id="statContacts">-</h3>
                        </div>
                        <div class="p-2 bg-green-50 rounded-lg">
                            <i class="fas fa-address-book text-green-600 text-xl"></i>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Across <span id="statRegions">-</span> regions</p>
                </div>
                
                <div class="stat-card rounded-xl p-6 shadow-sm">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm font-medium text-gray-600 mb-1">Closing Soon</p>
                            <h3 class="text-3xl font-bold text-gray-900" id="statClosing">-</h3>
                        </div>
                        <div class="p-2 bg-orange-50 rounded-lg">
                            <i class="fas fa-clock text-orange-600 text-xl"></i>
                        </div>
                    </div>
                    <p class="text-xs text-orange-600 mt-2">Within 7 days</p>
                </div>
            </div>

            <!-- Region Selector with Search -->
            <div class="mb-8">
                <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6 gap-4">
                    <div>
                        <h2 class="text-2xl font-bold display-font text-gray-900">Select Region</h2>
                        <p class="text-sm text-gray-500 mt-1">Browse by zone or search all 77 Queensland LGAs</p>
                    </div>
                    
                    <!-- Zone Filter -->
                    <div class="flex flex-wrap gap-2">
                        <button onclick="filterByZone('all')" class="zone-filter px-4 py-2 rounded-full text-sm font-medium bg-[#771414] text-white shadow-md transition-all" data-zone="all">
                            All Zones
                        </button>
                        <button onclick="filterByZone('SEQ')" class="zone-filter px-4 py-2 rounded-full text-sm font-medium bg-white text-gray-600 hover:bg-gray-100 border border-gray-200 transition-all" data-zone="SEQ">
                            South East QLD
                        </button>
                        <button onclick="filterByZone('NQ')" class="zone-filter px-4 py-2 rounded-full text-sm font-medium bg-white text-gray-600 hover:bg-gray-100 border border-gray-200 transition-all" data-zone="NQ">
                            North QLD
                        </button>
                        <button onclick="filterByZone('CQ')" class="zone-filter px-4 py-2 rounded-full text-sm font-medium bg-white text-gray-600 hover:bg-gray-100 border border-gray-200 transition-all" data-zone="CQ">
                            Central QLD
                        </button>
                        <button onclick="filterByZone('SWQ')" class="zone-filter px-4 py-2 rounded-full text-sm font-medium bg-white text-gray-600 hover:bg-gray-100 border border-gray-200 transition-all" data-zone="SWQ">
                            South West QLD
                        </button>
                        <button onclick="filterByZone('FWQ')" class="zone-filter px-4 py-2 rounded-full text-sm font-medium bg-white text-gray-600 hover:bg-gray-100 border border-gray-200 transition-all" data-zone="FWQ">
                            Far North QLD
                        </button>
                    </div>
                </div>
                
                <!-- Region Tabs Container -->
                <div class="region-group rounded-xl p-4 mb-6">
                    <div class="flex space-x-2 overflow-x-auto pb-2 region-scroll" id="regionTabs" style="max-height: 200px; flex-wrap: wrap;">
                        <!-- Tabs injected by JS -->
                    </div>
                </div>
                
                <div id="regionContent" class="space-y-6">
                    <div class="flex items-center justify-center h-64">
                        <div class="loading-skeleton w-full h-full rounded-xl"></div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Add/Edit Modal -->
        <div id="entryModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
            <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
                <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center z-10">
                    <h3 class="text-xl font-bold display-font" id="modalTitle">Add New Entry</h3>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="entryForm" class="p-6 space-y-4">
                    <input type="hidden" id="entryId">
                    <input type="hidden" id="entryRegion">
                    <input type="hidden" id="entryType">
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Title/Project Name *</label>
                            <input type="text" id="entryTitle" required class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                        </div>
                        
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                            <select id="entryCategory" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none bg-white">
                                <option value="Infrastructure">Infrastructure</option>
                                <option value="Construction">Construction</option>
                                <option value="Professional Services">Professional Services</option>
                                <option value="IT & Digital">IT & Digital</option>
                                <option value="Environmental">Environmental</option>
                                <option value="Community Services">Community Services</option>
                                <option value="Waste Management">Waste Management</option>
                                <option value="Water & Sewerage">Water & Sewerage</option>
                                <option value="Roads & Transport">Roads & Transport</option>
                                <option value="Parks & Recreation">Parks & Recreation</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Value ($)</label>
                            <input type="text" id="entryValue" placeholder="$0.00" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                        </div>
                        
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Closing Date</label>
                            <input type="date" id="entryDate" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                        </div>
                        
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                            <select id="entryPriority" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none bg-white">
                                <option value="High">High</option>
                                <option value="Medium" selected>Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                        
                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea id="entryDescription" rows="3" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none"></textarea>
                        </div>
                        
                        <div class="col-span-2 border-t pt-4 mt-2">
                            <h4 class="font-semibold text-gray-900 mb-3 flex items-center">
                                <i class="fas fa-user-tie mr-2 text-[#771414]"></i> Contact Details
                            </h4>
                        </div>
                        
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Contact Name</label>
                            <input type="text" id="contactName" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                        </div>
                        
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Position</label>
                            <input type="text" id="contactPosition" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                        </div>
                        
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" id="contactEmail" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                        </div>
                        
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                            <input type="tel" id="contactPhone" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        <button type="button" onclick="closeModal()" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">Cancel</button>
                        <button type="submit" class="px-6 py-2 bg-[#771414] text-white rounded-lg hover:bg-[#5a1010] transition-colors shadow-lg">
                            <i class="fas fa-save mr-2"></i> Save Entry
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div id="toastContainer" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

        <!-- Quick Actions -->
        <div class="fixed bottom-8 right-8 flex flex-col space-y-3">
            <button onclick="showAddModal('tender')" class="w-14 h-14 bg-[#771414] text-white rounded-full shadow-lg hover:shadow-xl transform hover:scale-110 transition-all flex items-center justify-center group relative">
                <i class="fas fa-plus text-xl"></i>
                <span class="absolute right-16 bg-gray-900 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">Add Tender</span>
            </button>
        </div>
    </div>

    <script>
        // ==================== ALL 77 QUEENSLAND LGAs ====================
        const qldRegions = [
            // SOUTH EAST QUEENSLAND (SEQ) - 20 LGAs
            { id: 'brisbane', name: 'Brisbane City Council', type: 'City', population: '1.2M', zone: 'SEQ', region: 'Metropolitan' },
            { id: 'goldcoast', name: 'Gold Coast City Council', type: 'City', population: '600K', zone: 'SEQ', region: 'Metropolitan' },
            { id: 'moretonbay', name: 'Moreton Bay Regional Council', type: 'Regional', population: '460K', zone: 'SEQ', region: 'Metropolitan' },
            { id: 'logan', name: 'Logan City Council', type: 'City', population: '320K', zone: 'SEQ', region: 'Metropolitan' },
            { id: 'redland', name: 'Redland City Council', type: 'City', population: '160K', zone: 'SEQ', region: 'Metropolitan' },
            { id: 'ipswich', name: 'Ipswich City Council', type: 'City', population: '200K', zone: 'SEQ', region: 'Metropolitan' },
            { id: 'toowoomba', name: 'Toowoomba Regional Council', type: 'Regional', population: '170K', zone: 'SEQ', region: 'Darling Downs' },
            { id: 'sunshinecoast', name: 'Sunshine Coast Regional Council', type: 'Regional', population: '300K', zone: 'SEQ', region: 'Coastal' },
            { id: 'noosa', name: 'Noosa Shire Council', type: 'Shire', population: '55K', zone: 'SEQ', region: 'Coastal' },
            { id: 'somerset', name: 'Somerset Regional Council', type: 'Regional', population: '25K', zone: 'SEQ', region: 'Rural' },
            { id: 'lockyervalley', name: 'Lockyer Valley Regional Council', type: 'Regional', population: '40K', zone: 'SEQ', region: 'Rural' },
            { id: 'scenicrim', name: 'Scenic Rim Regional Council', type: 'Regional', population: '42K', zone: 'SEQ', region: 'Rural' },
            { id: 'southburnett', name: 'South Burnett Regional Council', type: 'Regional', population: '33K', zone: 'SEQ', region: 'Rural' },
            { id: 'westerndowns', name: 'Western Downs Regional Council', type: 'Regional', population: '35K', zone: 'SEQ', region: 'Darling Downs' },
            { id: 'goondiwindi', name: 'Goondiwindi Regional Council', type: 'Regional', population: '11K', zone: 'SEQ', region: 'Darling Downs' },
            { id: 'southerndowns', name: 'Southern Downs Regional Council', type: 'Regional', population: '35K', zone: 'SEQ', region: 'Darling Downs' },
            { id: 'northburnett', name: 'North Burnett Regional Council', type: 'Regional', population: '11K', zone: 'SEQ', region: 'Wide Bay' },
            { id: 'bundaberg', name: 'Bundaberg Regional Council', type: 'Regional', population: '95K', zone: 'SEQ', region: 'Wide Bay' },
            { id: 'frasercoast', name: 'Fraser Coast Regional Council', type: 'Regional', population: '105K', zone: 'SEQ', region: 'Wide Bay' },
            { id: 'gympie', name: 'Gympie Regional Council', type: 'Regional', population: '51K', zone: 'SEQ', region: 'Wide Bay' },

            // NORTH QUEENSLAND (NQ) - 11 LGAs
            { id: 'townsville', name: 'Townsville City Council', type: 'City', population: '190K', zone: 'NQ', region: 'North Coast' },
            { id: 'mackay', name: 'Mackay Regional Council', type: 'Regional', population: '120K', zone: 'NQ', region: 'North Coast' },
            { id: 'whitsunday', name: 'Whitsunday Regional Council', type: 'Regional', population: '35K', zone: 'NQ', region: 'North Coast' },
            { id: 'burdekin', name: 'Burdekin Shire Council', type: 'Shire', population: '17K', zone: 'NQ', region: 'North Coast' },
            { id: 'charterstowers', name: 'Charters Towers Regional Council', type: 'Regional', population: '12K', zone: 'NQ', region: 'Inland' },
            { id: 'hinchinbrook', name: 'Hinchinbrook Shire Council', type: 'Shire', population: '11K', zone: 'NQ', region: 'North Coast' },
            { id: 'mounthypipamee', name: 'Mount Hypipamee Shire Council', type: 'Shire', population: '3K', zone: 'NQ', region: 'Tablelands' },
            { id: 'tablelands', name: 'Tablelands Regional Council', type: 'Regional', population: '26K', zone: 'NQ', region: 'Tablelands' },
            { id: 'cassowarycoast', name: 'Cassowary Coast Regional Council', type: 'Regional', population: '30K', zone: 'NQ', region: 'North Coast' },
            { id: 'cairns', name: 'Cairns Regional Council', type: 'Regional', population: '165K', zone: 'NQ', region: 'Far North' },
            { id: 'yarrabah', name: 'Yarrabah Aboriginal Shire Council', type: 'Aboriginal Shire', population: '2.5K', zone: 'NQ', region: 'Far North' },

            // CENTRAL QUEENSLAND (CQ) - 13 LGAs
            { id: 'rockhampton', name: 'Rockhampton Regional Council', type: 'Regional', population: '80K', zone: 'CQ', region: 'Central' },
            { id: 'gladstone', name: 'Gladstone Regional Council', type: 'Regional', population: '63K', zone: 'CQ', region: 'Central Coast' },
            { id: 'banana', name: 'Banana Shire Council', type: 'Shire', population: '14K', zone: 'CQ', region: 'Central Inland' },
            { id: 'centralhighlands', name: 'Central Highlands Regional Council', type: 'Regional', population: '12K', zone: 'CQ', region: 'Central Inland' },
            { id: 'woorabinda', name: 'Woorabinda Aboriginal Shire Council', type: 'Aboriginal Shire', population: '1K', zone: 'CQ', region: 'Central' },
            { id: 'livingstone', name: 'Livingstone Shire Council', type: 'Shire', population: '38K', zone: 'CQ', region: 'Central Coast' },
            { id: 'isaac', name: 'Isaac Regional Council', type: 'Regional', population: '22K', zone: 'CQ', region: 'Central Inland' },
            { id: 'barcaldine', name: 'Barcaldine Regional Council', type: 'Regional', population: '3K', zone: 'CQ', region: 'Central West' },
            { id: 'barcoo', name: 'Barcoo Shire Council', type: 'Shire', population: '300', zone: 'CQ', region: 'Central West' },
            { id: 'blackalltambo', name: 'Blackall-Tambo Regional Council', type: 'Regional', population: '2K', zone: 'CQ', region: 'Central West' },
            { id: 'diamantina', name: 'Diamantina Shire Council', type: 'Shire', population: '300', zone: 'CQ', region: 'Central West' },
            { id: 'longreach', name: 'Longreach Regional Council', type: 'Regional', population: '4K', zone: 'CQ', region: 'Central West' },
            { id: 'wooramel', name: 'Wooramel Shire Council', type: 'Shire', population: '200', zone: 'CQ', region: 'Central West' },

            // SOUTH WEST QUEENSLAND (SWQ) - 14 LGAs
            { id: 'maranoa', name: 'Maranoa Regional Council', type: 'Regional', population: '13K', zone: 'SWQ', region: 'South West' },
            { id: 'balonne', name: 'Balonne Shire Council', type: 'Shire', population: '4K', zone: 'SWQ', region: 'South West' },
            { id: 'bulloo', name: 'Bulloo Shire Council', type: 'Shire', population: '400', zone: 'SWQ', region: 'South West' },
            { id: 'murweh', name: 'Murweh Shire Council', type: 'Shire', population: '4K', zone: 'SWQ', region: 'South West' },
            { id: 'paroo', name: 'Paroo Shire Council', type: 'Shire', population: '1.5K', zone: 'SWQ', region: 'South West' },
            { id: 'quilpie', name: 'Quilpie Shire Council', type: 'Shire', population: '800', zone: 'SWQ', region: 'South West' },
            { id: 'charleville', name: 'Charleville Shire Council', type: 'Shire', population: '3.5K', zone: 'SWQ', region: 'South West' },
            { id: 'roma', name: 'Roma Shire Council', type: 'Shire', population: '7K', zone: 'SWQ', region: 'Darling Downs' },
            { id: 'booringa', name: 'Booringa Shire Council', type: 'Shire', population: '3K', zone: 'SWQ', region: 'Darling Downs' },
            { id: 'warroo', name: 'Warroo Shire Council', type: 'Shire', population: '1K', zone: 'SWQ', region: 'Darling Downs' },
            { id: 'bendemere', name: 'Bendemere Shire Council', type: 'Shire', population: '1.5K', zone: 'SWQ', region: 'Darling Downs' },
            { id: 'boomi', name: 'Boomi Shire Council', type: 'Shire', population: '600', zone: 'SWQ', region: 'Darling Downs' },
            { id: 'tara', name: 'Tara Shire Council', type: 'Shire', population: '3K', zone: 'SWQ', region: 'Darling Downs' },
            { id: 'waggamba', name: 'Waggamba Shire Council', type: 'Shire', population: '3.5K', zone: 'SWQ', region: 'Darling Downs' },

            // FAR NORTH & GULF QUEENSLAND (FWQ) - 19 LGAs
            { id: 'torres', name: 'Torres Shire Council', type: 'Shire', population: '4K', zone: 'FWQ', region: 'Torres Strait' },
            { id: 'torresstraitisland', name: 'Torres Strait Island Regional Council', type: 'Regional', population: '4.5K', zone: 'FWQ', region: 'Torres Strait' },
            { id: 'northernpeninsula', name: 'Northern Peninsula Area Regional Council', type: 'Regional', population: '3K', zone: 'FWQ', region: 'Cape York' },
            { id: 'aurukun', name: 'Aurukun Shire Council', type: 'Shire', population: '1.5K', zone: 'FWQ', region: 'Cape York' },
            { id: 'cook', name: 'Cook Shire Council', type: 'Shire', population: '4K', zone: 'FWQ', region: 'Cape York' },
            { id: 'croydon', name: 'Croydon Shire Council', type: 'Shire', population: '300', zone: 'FWQ', region: 'Gulf' },
            { id: 'etheridge', name: 'Etheridge Shire Council', type: 'Shire', population: '900', zone: 'FWQ', region: 'Gulf' },
            { id: ' Hopevale', name: 'Hope Vale Aboriginal Shire Council', type: 'Aboriginal Shire', population: '1K', zone: 'FWQ', region: 'Cape York' },
            { id: 'kowanyama', name: 'Kowanyama Aboriginal Shire Council', type: 'Aboriginal Shire', population: '1K', zone: 'FWQ', region: 'Cape York' },
            { id: 'lockhartriver', name: 'Lockhart River Aboriginal Shire Council', type: 'Aboriginal Shire', population: '700', zone: 'FWQ', region: 'Cape York' },
            { id: 'mapoon', name: 'Mapoon Aboriginal Shire Council', type: 'Aboriginal Shire', population: '400', zone: 'FWQ', region: 'Cape York' },
            { id: 'mornington', name: 'Mornington Shire Council', type: 'Shire', population: '1.2K', zone: 'FWQ', region: 'Gulf' },
            { id: 'napranum', name: 'Napranum Aboriginal Shire Council', type: 'Aboriginal Shire', population: '1K', zone: 'FWQ', region: 'Cape York' },
            { id: 'pormpuraaw', name: 'Pormpuraaw Aboriginal Shire Council', type: 'Aboriginal Shire', population: '700', zone: 'FWQ', region: 'Cape York' },
            { id: 'carpentaria', name: 'Carpentaria Shire Council', type: 'Shire', population: '2K', zone: 'FWQ', region: 'Gulf' },
            { id: 'burke', name: 'Burke Shire Council', type: 'Shire', population: '400', zone: 'FWQ', region: 'Gulf' },
            { id: 'doomadgee', name: 'Doomadgee Aboriginal Shire Council', type: 'Aboriginal Shire', population: '1.5K', zone: 'FWQ', region: 'Gulf' },
            { id: 'mckinlay', name: 'McKinlay Shire Council', type: 'Shire', population: '900', zone: 'FWQ', region: 'North West' },
            { id: 'richmond', name: 'Richmond Shire Council', type: 'Shire', population: '800', zone: 'FWQ', region: 'North West' },
            { id: 'flinders', name: 'Flinders Shire Council', type: 'Shire', population: '1.5K', zone: 'FWQ', region: 'North West' }
        ];

        // ==================== FIREBASE CONFIGURATION ====================
       // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyACeeQF5c4sKwQxM4LaW4pzlPd7R5HuRSg",
  authDomain: "queensland-business-reporting.firebaseapp.com",
  projectId: "queensland-business-reporting",
  storageBucket: "queensland-business-reporting.firebasestorage.app",
  messagingSenderId: "271437640355",
  appId: "1:271437640355:web:d11f19e2b61c30d5bd8516",
  measurementId: "G-XE0LCMYLC5"
};

        let db, auth;
        let isOnline = navigator.onLine;
        let currentUser = null;
        let unsubscribe = null;
        let currentZone = 'all';

        try {
            if (firebaseConfig.apiKey !== "YOUR_API_KEY") {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                db.enablePersistence({ synchronizeTabs: true }).catch(err => console.log("Persistence failed:", err));
            }
        } catch (e) {
            console.log("Firebase not initialized:", e);
        }

        let database = { tenders: [], awarded: [], contacts: [] };
        let currentRegion = 'brisbane';

        // ==================== AUTHENTICATION ====================
        
        if (auth) {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    document.getElementById('authModal').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    document.getElementById('userEmail').textContent = user.email;
                    initializeApp();
                } else {
                    document.getElementById('authModal').classList.remove('hidden');
                    document.getElementById('mainApp').classList.add('hidden');
                }
            });
        } else {
            document.getElementById('authModal').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userEmail').textContent = 'Demo Mode';
            initializeApp();
        }

        function signIn() {
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            
            if (!email || !password) {
                showToast('Please enter email and password', 'error');
                return;
            }

            if (auth) {
                auth.signInWithEmailAndPassword(email, password)
                    .catch(error => showToast(error.message, 'error'));
            } else {
                showToast('Firebase not configured. Using demo mode.', 'info');
                document.getElementById('authModal').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                initializeApp();
            }
        }

        function signUp() {
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            
            if (!email || !password) {
                showToast('Please enter email and password', 'error');
                return;
            }

            if (auth) {
                auth.createUserWithEmailAndPassword(email, password)
                    .then(() => showToast('Account created!', 'success'))
                    .catch(error => showToast(error.message, 'error'));
            }
        }

        function signOut() {
            if (auth) {
                auth.signOut();
            }
        }

        // ==================== APP INITIALIZATION ====================
        
        function initializeApp() {
            renderRegionTabs();
            
            if (db && currentUser) {
                setupRealtimeSync();
            } else {
                loadSampleData();
                loadRegion(currentRegion);
                updateStats();
            }
            
            window.addEventListener('online', () => {
                isOnline = true;
                document.getElementById('offlineBanner').classList.remove('show');
                showToast('Back online', 'success');
                updateSyncStatus('Synced');
            });
            
            window.addEventListener('offline', () => {
                isOnline = false;
                document.getElementById('offlineBanner').classList.add('show');
                updateSyncStatus('Offline');
            });
        }

        function setupRealtimeSync() {
            const userDoc = db.collection('users').doc(currentUser.uid);
            
            unsubscribe = userDoc.onSnapshot(doc => {
                if (doc.exists) {
                    database = doc.data();
                } else {
                    userDoc.set({ tenders: [], awarded: [], contacts: [] });
                }
                loadRegion(currentRegion);
                updateStats();
                updateSyncStatus('Synced');
            }, err => {
                console.error("Sync error:", err);
                updateSyncStatus('Error');
            });
        }

        function loadSampleData() {
            database = {
                tenders: [
                    {
                        id: 1,
                        regionId: 'brisbane',
                        title: 'Road Infrastructure Upgrade - Northern Suburbs',
                        category: 'Infrastructure',
                        value: '$2.5M',
                        closingDate: '2024-12-15',
                        priority: 'High',
                        description: 'Major road resurfacing and intersection improvements.',
                        status: 'Open',
                        contact: { name: 'Sarah Mitchell', position: 'Senior Procurement Officer', email: 's.mitchell@brisbane.qld.gov.au', phone: '(07) 3403 8888' },
                        createdAt: new Date().toISOString()
                    }
                ],
                awarded: [],
                contacts: []
            };
        }

        // ==================== REGION FILTERING ====================
        
        function filterByZone(zone) {
            currentZone = zone;
            
            // Update zone buttons
            document.querySelectorAll('.zone-filter').forEach(btn => {
                if (btn.dataset.zone === zone) {
                    btn.className = 'zone-filter px-4 py-2 rounded-full text-sm font-medium bg-[#771414] text-white shadow-md transition-all';
                } else {
                    btn.className = 'zone-filter px-4 py-2 rounded-full text-sm font-medium bg-white text-gray-600 hover:bg-gray-100 border border-gray-200 transition-all';
                }
            });
            
            renderRegionTabs();
            
            // If current region not in filtered list, switch to first available
            const visibleRegions = getVisibleRegions();
            if (visibleRegions.length > 0 && !visibleRegions.find(r => r.id === currentRegion)) {
                loadRegion(visibleRegions[0].id);
            }
        }

        function getVisibleRegions() {
            if (currentZone === 'all') return qldRegions;
            return qldRegions.filter(r => r.zone === currentZone);
        }

        function renderRegionTabs() {
            const container = document.getElementById('regionTabs');
            const regions = getVisibleRegions();
            
            container.innerHTML = regions.map(region => `
                <button onclick="loadRegion('${region.id}')" 
                        class="region-tab m-1 px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap ${region.id === currentRegion ? 'bg-[#771414] text-white shadow-md' : 'bg-white text-gray-600 hover:bg-gray-50 border border-gray-200'}"
                        data-region="${region.id}"
                        title="${region.name} - ${region.region}">
                    <div class="flex flex-col items-start">
                        <span class="font-semibold truncate max-w-[200px]">${region.name.replace(' Council', '').replace(' Shire', '')}</span>
                        <span class="text-xs opacity-75">${region.region}</span>
                    </div>
                </button>
            `).join('');
        }

        function loadRegion(regionId) {
            currentRegion = regionId;
            
            document.querySelectorAll('.region-tab').forEach(tab => {
                if(tab.dataset.region === regionId) {
                    tab.className = 'region-tab m-1 px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap bg-[#771414] text-white shadow-md';
                } else {
                    tab.className = 'region-tab m-1 px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap bg-white text-gray-600 hover:bg-gray-50 border border-gray-200';
                }
            });

            const region = qldRegions.find(r => r.id === regionId);
            
            document.getElementById('regionContent').innerHTML = `
                <div class="glass-panel rounded-2xl p-6 mb-6 border-l-4 border-[#771414]">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded font-medium">${region.zone}</span>
                                <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">${region.region}</span>
                                <span class="px-2 py-1 bg-[#771414] bg-opacity-10 text-[#771414] text-xs rounded font-medium">${region.type}</span>
                            </div>
                            <h2 class="text-2xl font-bold display-font text-gray-900">${region.name}</h2>
                            <p class="text-gray-500 mt-1">Population: ${region.population}</p>
                        </div>
                        <div class="flex space-x-3 mt-4 md:mt-0">
                            <button onclick="showAddModal('tender')" class="px-4 py-2 bg-[#771414] text-white rounded-lg hover:bg-[#5a1010] transition-colors shadow-md text-sm font-medium">
                                <i class="fas fa-plus mr-2"></i> Add Tender
                            </button>
                            <button onclick="showAddModal('awarded')" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors shadow-md text-sm font-medium">
                                <i class="fas fa-plus mr-2"></i> Add Awarded Work
                            </button>
                            <button onclick="showAddModal('contact')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-md text-sm font-medium">
                                <i class="fas fa-plus mr-2"></i> Add Contact
                            </button>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-1">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold display-font flex items-center">
                                <i class="fas fa-file-alt text-[#771414] mr-2"></i> Available Tenders
                                <span class="ml-2 bg-red-100 text-[#771414] text-xs px-2 py-1 rounded-full">${database.tenders.filter(t => t.regionId === regionId).length}</span>
                            </h3>
                        </div>
                        <div class="space-y-4" id="tendersList">
                            ${renderTenders(regionId)}
                        </div>
                    </div>

                    <div class="lg:col-span-1">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold display-font flex items-center">
                                <i class="fas fa-trophy text-yellow-600 mr-2"></i> Awarded Works
                                <span class="ml-2 bg-yellow-100 text-yellow-700 text-xs px-2 py-1 rounded-full">${database.awarded.filter(a => a.regionId === regionId).length}</span>
                            </h3>
                        </div>
                        <div class="space-y-4" id="awardedList">
                            ${renderAwarded(regionId)}
                        </div>
                    </div>

                    <div class="lg:col-span-1">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold display-font flex items-center">
                                <i class="fas fa-address-card text-green-600 mr-2"></i> Local Contacts
                                <span class="ml-2 bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full">${database.contacts.filter(c => c.regionId === regionId).length}</span>
                            </h3>
                        </div>
                        <div class="space-y-4" id="contactsList">
                            ${renderContacts(regionId)}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTenders(regionId) {
            const tenders = database.tenders.filter(t => t.regionId === regionId);
            if (tenders.length === 0) {
                return `<div class="text-center py-8 text-gray-400 bg-white rounded-xl border-2 border-dashed border-gray-200">
                    <i class="fas fa-inbox text-4xl mb-2"></i>
                    <p>No active tenders</p>
                </div>`;
            }
            
            return tenders.map(tender => {
                const daysLeft = Math.ceil((new Date(tender.closingDate) - new Date()) / (1000 * 60 * 60 * 24));
                const priorityClass = tender.priority === 'High' ? 'priority-high' : tender.priority === 'Medium' ? 'priority-medium' : 'priority-low';
                
                return `
                <div class="region-card rounded-xl p-5 shadow-sm card-hover ${priorityClass} cursor-pointer group" onclick="editEntry('tender', ${tender.id})">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs font-semibold px-2 py-1 rounded bg-gray-100 text-gray-600">${tender.category}</span>
                        ${daysLeft <= 7 ? '<span class="text-xs font-bold text-red-600 bg-red-50 px-2 py-1 rounded animate-pulse">CLOSING SOON</span>' : ''}
                    </div>
                    <h4 class="font-bold text-gray-900 mb-2 line-clamp-2 group-hover:text-[#771414] transition-colors">${tender.title}</h4>
                    <div class="space-y-2 text-sm text-gray-600">
                        <div class="flex items-center"><i class="fas fa-dollar-sign w-5 text-gray-400"></i> ${tender.value}</div>
                        <div class="flex items-center ${daysLeft <= 7 ? 'text-red-600 font-semibold' : ''}">
                            <i class="fas fa-calendar w-5 text-gray-400"></i> ${formatDate(tender.closingDate)} (${daysLeft} days)
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-gray-100 flex items-center justify-between">
                        <div class="flex items-center text-xs text-gray-500">
                            <i class="fas fa-user w-4"></i> ${tender.contact.name}
                        </div>
                        <button class="text-[#771414] hover:text-[#5a1010] text-sm font-medium opacity-0 group-hover:opacity-100 transition-opacity">
                            Edit <i class="fas fa-arrow-right ml-1"></i>
                        </button>
                    </div>
                </div>
                `;
            }).join('');
        }

        function renderAwarded(regionId) {
            const awarded = database.awarded.filter(a => a.regionId === regionId);
            if (awarded.length === 0) {
                return `<div class="text-center py-8 text-gray-400 bg-white rounded-xl border-2 border-dashed border-gray-200">
                    <i class="fas fa-clipboard-check text-4xl mb-2"></i>
                    <p>No awarded works recorded</p>
                </div>`;
            }
            
            return awarded.map(item => `
                <div class="bg-white rounded-xl p-5 shadow-sm border-l-4 border-yellow-500 card-hover cursor-pointer" onclick="editEntry('awarded', ${item.id})">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs font-semibold px-2 py-1 rounded bg-yellow-50 text-yellow-700">Awarded</span>
                        <span class="text-xs text-gray-500">${formatDate(item.awardedDate)}</span>
                    </div>
                    <h4 class="font-bold text-gray-900 mb-2">${item.title}</h4>
                    <div class="space-y-2 text-sm text-gray-600 mb-3">
                        <div class="flex items-center"><i class="fas fa-dollar-sign w-5 text-gray-400"></i> ${item.value}</div>
                        <div class="flex items-center"><i class="fas fa-building w-5 text-gray-400"></i> ${item.awardedTo}</div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-3 text-xs text-gray-600">
                        <span class="font-semibold">Contact:</span> ${item.contact.name}  ${item.contact.phone}
                    </div>
                </div>
            `).join('');
        }

        function renderContacts(regionId) {
            const contacts = database.contacts.filter(c => c.regionId === regionId);
            if (contacts.length === 0) {
                return `<div class="text-center py-8 text-gray-400 bg-white rounded-xl border-2 border-dashed border-gray-200">
                    <i class="fas fa-users text-4xl mb-2"></i>
                    <p>No contacts added</p>
                </div>`;
            }
            
            return contacts.map(contact => `
                <div class="bg-white rounded-xl p-5 shadow-sm border-l-4 border-green-500 card-hover cursor-pointer" onclick="editEntry('contact', ${contact.id})">
                    <div class="flex items-start space-x-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-100 to-green-200 flex items-center justify-center text-green-700 font-bold text-lg flex-shrink-0">
                            ${contact.name.charAt(0)}
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="font-bold text-gray-900 truncate">${contact.name}</h4>
                            <p class="text-sm text-gray-500">${contact.position}</p>
                            <p class="text-xs text-gray-400 mt-1">${contact.department}</p>
                        </div>
                    </div>
                    <div class="mt-3 space-y-1 text-sm">
                        <a href="mailto:${contact.email}" class="flex items-center text-gray-600 hover:text-[#771414] transition-colors">
                            <i class="fas fa-envelope w-5 text-gray-400"></i> ${contact.email}
                        </a>
                        <a href="tel:${contact.phone}" class="flex items-center text-gray-600 hover:text-[#771414] transition-colors">
                            <i class="fas fa-phone w-5 text-gray-400"></i> ${contact.phone}
                        </a>
                    </div>
                    ${contact.notes ? `<p class="mt-2 text-xs text-gray-500 italic bg-gray-50 p-2 rounded">${contact.notes}</p>` : ''}
                </div>
            `).join('');
        }

        // ==================== CRUD OPERATIONS ====================
        
        function showAddModal(type) {
            document.getElementById('modalTitle').textContent = type === 'tender' ? 'Add New Tender' : type === 'awarded' ? 'Add Awarded Work' : 'Add Local Contact';
            document.getElementById('entryType').value = type;
            document.getElementById('entryRegion').value = currentRegion;
            document.getElementById('entryId').value = '';
            document.getElementById('entryForm').reset();
            
            const valueField = document.getElementById('entryValue').parentElement;
            const dateField = document.getElementById('entryDate').parentElement;
            const priorityField = document.getElementById('entryPriority').parentElement;
            
            if (type === 'contact') {
                valueField.style.display = 'none';
                dateField.style.display = 'none';
                priorityField.style.display = 'none';
            } else {
                valueField.style.display = 'block';
                dateField.style.display = 'block';
                priorityField.style.display = 'block';
            }
            
            document.getElementById('entryModal').classList.remove('hidden');
        }

        function editEntry(type, id) {
            const item = database[type + 's'].find(x => x.id === id);
            if (!item) return;
            
            showAddModal(type);
            document.getElementById('modalTitle').textContent = 'Edit ' + (type === 'tender' ? 'Tender' : type === 'awarded' ? 'Awarded Work' : 'Contact');
            document.getElementById('entryId').value = id;
            
            document.getElementById('entryTitle').value = item.title || item.name || '';
            document.getElementById('entryCategory').value = item.category || item.department || 'Other';
            document.getElementById('entryValue').value = item.value || '';
            document.getElementById('entryDate').value = item.closingDate || item.awardedDate || '';
            document.getElementById('entryPriority').value = item.priority || 'Medium';
            document.getElementById('entryDescription').value = item.description || item.notes || '';
            
            const contact = item.contact || item;
            document.getElementById('contactName').value = contact.name || '';
            document.getElementById('contactPosition').value = contact.position || '';
            document.getElementById('contactEmail').value = contact.email || '';
            document.getElementById('contactPhone').value = contact.phone || '';
        }

        function closeModal() {
            document.getElementById('entryModal').classList.add('hidden');
        }

        document.getElementById('entryForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const type = document.getElementById('entryType').value;
            const id = document.getElementById('entryId').value;
            const regionId = document.getElementById('entryRegion').value;
            
            const formData = {
                title: document.getElementById('entryTitle').value,
                category: document.getElementById('entryCategory').value,
                value: document.getElementById('entryValue').value,
                closingDate: document.getElementById('entryDate').value,
                priority: document.getElementById('entryPriority').value,
                description: document.getElementById('entryDescription').value,
                contact: {
                    name: document.getElementById('contactName').value,
                    position: document.getElementById('contactPosition').value,
                    email: document.getElementById('contactEmail').value,
                    phone: document.getElementById('contactPhone').value
                },
                updatedAt: new Date().toISOString()
            };
            
            if (type === 'contact') {
                formData.name = formData.title;
                formData.position = formData.contact.position;
                formData.department = formData.category;
                formData.email = formData.contact.email;
                formData.phone = formData.contact.phone;
                formData.notes = formData.description;
                delete formData.title;
                delete formData.contact;
            }
            
            if (id) {
                const index = database[type + 's'].findIndex(x => x.id == id);
                if (index !== -1) {
                    database[type + 's'][index] = { ...database[type + 's'][index], ...formData };
                }
            } else {
                const newId = Date.now();
                database[type + 's'].push({
                    id: newId,
                    regionId: regionId,
                    ...formData,
                    createdAt: new Date().toISOString(),
                    status: type === 'tender' ? 'Open' : undefined
                });
            }
            
            if (db && currentUser) {
                try {
                    await db.collection('users').doc(currentUser.uid).set(database);
                    showToast('Saved successfully!', 'success');
                } catch (err) {
                    showToast('Error saving: ' + err.message, 'error');
                    return;
                }
            } else {
                showToast('Saved locally (Firebase not configured)', 'info');
            }
            
            closeModal();
            loadRegion(currentRegion);
            updateStats();
        });

        // ==================== STATS & UTILITIES ====================
        
        function updateStats() {
            const activeTenders = database.tenders.filter(t => t.status === 'Open').length;
            const closingSoon = database.tenders.filter(t => {
                const days = Math.ceil((new Date(t.closingDate) - new Date()) / (1000 * 60 * 60 * 24));
                return days <= 7 && days >= 0;
            }).length;
            
            document.getElementById('statActiveTenders').textContent = activeTenders;
            document.getElementById('statClosing').textContent = closingSoon;
            document.getElementById('statAwarded').textContent = database.awarded.length;
            document.getElementById('statContacts').textContent = database.contacts.length;
            
            const activeRegions = new Set([
                ...database.tenders.map(t => t.regionId),
                ...database.awarded.map(a => a.regionId),
                ...database.contacts.map(c => c.regionId)
            ]);
            document.getElementById('statRegions').textContent = activeRegions.size;
            
            const totalValue = database.awarded.reduce((sum, item) => {
                const val = parseFloat(item.value.replace(/[^0-9.]/g, ''));
                return sum + (isNaN(val) ? 0 : val);
            }, 0);
            document.getElementById('statTotalValue').textContent = '$' + (totalValue / 1000000).toFixed(1) + 'M';
        }

        function updateSyncStatus(status) {
            const indicator = document.getElementById('syncStatus');
            if (status === 'Synced') {
                indicator.innerHTML = '<i class="fas fa-check-circle mr-1"></i> Synced';
                indicator.className = 'flex items-center text-green-600';
            } else if (status === 'Offline') {
                indicator.innerHTML = '<i class="fas fa-wifi-slash mr-1"></i> Offline';
                indicator.className = 'flex items-center text-orange-600';
            } else {
                indicator.innerHTML = '<i class="fas fa-sync-alt mr-1 fa-spin"></i> Syncing...';
                indicator.className = 'flex items-center text-blue-600';
            }
        }

        function globalSearch() {
            const query = document.getElementById('globalSearch').value.toLowerCase();
            if (!query) {
                loadRegion(currentRegion);
                return;
            }
            
            // Search across all regions
            const filteredTenders = database.tenders.filter(t => 
                t.title.toLowerCase().includes(query) || 
                t.category.toLowerCase().includes(query) ||
                t.contact.name.toLowerCase().includes(query)
            );
            
            // Show results from all regions
            document.getElementById('regionContent').innerHTML = `
                <div class="glass-panel rounded-2xl p-6 mb-6">
                    <h2 class="text-xl font-bold display-font mb-4">Search Results: "${query}"</h2>
                    <p class="text-gray-600 mb-4">Found ${filteredTenders.length} tenders across all 77 LGAs</p>
                    <button onclick="loadRegion('${currentRegion}')" class="text-[#771414] hover:underline mb-4">
                        <i class="fas fa-arrow-left mr-1"></i> Back to region view
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${filteredTenders.map(tender => {
                        const region = qldRegions.find(r => r.id === tender.regionId);
                        const daysLeft = Math.ceil((new Date(tender.closingDate) - new Date()) / (1000 * 60 * 60 * 24));
                        return `
                        <div class="region-card rounded-xl p-5 shadow-sm card-hover cursor-pointer" onclick="loadRegion('${tender.regionId}'); setTimeout(() => editEntry('tender', ${tender.id}), 100)">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-xs font-semibold px-2 py-1 rounded bg-[#771414] bg-opacity-10 text-[#771414]">${region.name}</span>
                                <span class="text-xs font-semibold px-2 py-1 rounded bg-gray-100 text-gray-600">${tender.category}</span>
                            </div>
                            <h4 class="font-bold text-gray-900 mb-2">${tender.title}</h4>
                            <div class="text-sm text-gray-600">${tender.value}  ${daysLeft} days left</div>
                        </div>`;
                    }).join('')}
                </div>
            `;
        }

        function exportToExcel() {
            let csv = 'Type,Region,Zone,Title,Category,Value,Date,Priority,Contact Name,Contact Email,Contact Phone,Description\n';
            
            database.tenders.forEach(t => {
                const region = qldRegions.find(r => r.id === t.regionId);
                csv += `Tender,${region.name},${region.zone},"${t.title}","${t.category}","${t.value}","${t.closingDate}","${t.priority}","${t.contact.name}","${t.contact.email}","${t.contact.phone}","${t.description}"\n`;
            });
            
            database.awarded.forEach(a => {
                const region = qldRegions.find(r => r.id === a.regionId);
                csv += `Awarded,${region.name},${region.zone},"${a.title}","${a.category}","${a.value}","${a.awardedDate}","","${a.contact.name}","${a.contact.email}","${a.contact.phone}","${a.description}"\n`;
            });
            
            database.contacts.forEach(c => {
                const region = qldRegions.find(r => r.id === c.regionId);
                csv += `Contact,${region.name},${region.zone},"${c.name}","${c.department}","","","","${c.name}","${c.email}","${c.phone}","${c.notes}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `QLD_Business_Report_77_LGAs_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            
            showToast('Excel file downloaded with all 77 LGAs!', 'success');
        }

        function shareReport() {
            const shareData = {
                title: 'QLD Business Development Report - 77 LGAs',
                text: `Business Development Report covering all 77 Queensland LGAs - ${database.tenders.length} active tenders, ${database.awarded.length} awarded works`,
                url: window.location.href
            };
            
            if (navigator.share) {
                navigator.share(shareData);
            } else {
                navigator.clipboard.writeText(window.location.href);
                showToast('Link copied to clipboard!', 'success');
            }
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };
            
            toast.className = `toast ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-2`;
            toast.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(toast