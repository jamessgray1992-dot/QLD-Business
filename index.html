<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QLD Business Development & CRM System - All 77 LGAs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

<script>
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyACeeQF5c4sKwQxM4LaW4pzlPd7R5HuRSg",
  authDomain: "queensland-business-reporting.firebaseapp.com",
  projectId: "queensland-business-reporting",
  storageBucket: "queensland-business-reporting.firebasestorage.app",
  messagingSenderId: "271437640355",
  appId: "1:271437640355:web:d11f19e2b61c30d5bd8516",
  measurementId: "G-XE0LCMYLC5"
    };
    
// Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    
    // ✅ ADD THIS: Set auth persistence to LOCAL
    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
        .catch((error) => {
            console.error("Auth persistence error:", error);
        });
    
    // ✅ ADD THIS: Listen for auth state changes
    auth.onAuthStateChanged((user) => {
        if (user) {
            // User is signed in
            console.log("User already signed in:", user.email);
            currentUser = user;
            document.getElementById('userEmail').textContent = user.email;
            
            // Check if approved and show app
            checkUserApproval(user);
        } else {
            // No user signed in, show auth modal
            console.log("No user signed in");
            document.getElementById('authModal').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }
    });
</script>
    <style>
        :root {
            --qld-maroon: #771414;
            --qld-gold: #FFCD00;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f0;
            background-image: radial-gradient(at 0% 0%, rgba(119, 20, 20, 0.03) 0px, transparent 50%);
        }

        h1, h2, h3, .display-font {
            font-family: 'Space Grotesk', sans-serif;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
        }

        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .region-card {
            background: linear-gradient(135deg, #ffffff 0%, #fafafa 100%);
            border-left: 4px solid var(--qld-maroon);
        }

        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .sync-indicator {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }

        .priority-high { border-left-color: #dc2626; }
        .priority-medium { border-left-color: #f59e0b; }
        .priority-low { border-left-color: #10b981; }

        .offline-banner {
            background: linear-gradient(90deg, #f59e0b, #d97706);
            color: white;
            transform: translateY(-100%);
            transition: transform 0.3s;
        }

        .offline-banner.show {
            transform: translateY(0);
        }

        .region-scroll::-webkit-scrollbar {
            height: 6px;
        }

        .region-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .region-scroll::-webkit-scrollbar-thumb {
            background: #771414;
            border-radius: 3px;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .toast {
            transform: translateX(120%);
            transition: transform 0.3s ease-out;
        }

        .toast.show {
            transform: translateX(0);
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--qld-maroon), var(--qld-gold));
        }

        .region-group {
            background: linear-gradient(135deg, #fafafa 0%, #f0f0f0 100%);
            border: 1px solid #e5e7eb;
        }

        .demo-badge {
            background: linear-gradient(90deg, #f59e0b, #d97706);
            color: white;
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 600;
        }

        .main-tab {
            position: relative;
            transition: all 0.3s;
        }

        .main-tab.active {
            color: #771414;
            font-weight: 600;
        }

        .main-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 3px;
            background: #771414;
            border-radius: 3px 3px 0 0;
        }

        .status-to-price { background: #dbeafe; color: #1e40af; }
        .status-priced { background: #dcfce7; color: #166534; }
        .status-not-pricing { background: #f3f4f6; color: #6b7280; }

        .crm-contact-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-left: 4px solid #3b82f6;
        }

        /* Category-specific card borders */
        .crm-contact-card.category-council { border-left-color: #3b82f6; }
        .crm-contact-card.category-supplier { border-left-color: #10b981; }
        .crm-contact-card.category-contractor { border-left-color: #f59e0b; }
        .crm-contact-card.category-competitor { border-left-color: #ef4444; }

        .interaction-timeline {
            position: relative;
            padding-left: 20px;
        }

        .interaction-timeline::before {
            content: '';
            position: absolute;
            left: 6px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e5e7eb;
        }

        .timeline-dot {
            position: absolute;
            left: 0;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #3b82f6;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #e5e7eb;
        }

        .not-won-card {
            background: linear-gradient(135deg, #ffffff 0%, #fef2f2 100%);
            border-left: 4px solid #ef4444;
        }

        /* Category badge styles */
        .category-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .category-council { background: #dbeafe; color: #1e40af; }
        .category-supplier { background: #d1fae5; color: #065f46; }
        .category-contractor { background: #fef3c7; color: #92400e; }
        .category-competitor { background: #fee2e2; color: #991b1b; }

        /* Zone Filter Button Colors */
        .zone-filter[data-zone="SEQ"].active { background-color: #771414 !important; color: white !important; }
        .zone-filter[data-zone="NQ"].active { background-color: #0369a1 !important; color: white !important; }
        .zone-filter[data-zone="CQ"].active { background-color: #059669 !important; color: white !important; }
        .zone-filter[data-zone="SWQ"].active { background-color: #d97706 !important; color: white !important; }
        .zone-filter[data-zone="FNQ"].active { background-color: #10b981 !important; color: white !important; }
        .zone-filter[data-zone="GULF"].active { background-color: #8b5cf6 !important; color: white !important; }
    </style>
<base target="_blank">
</head>
<body class="text-gray-800 min-h-screen">

    <!-- Offline Warning -->
    <div id="offlineBanner" class="offline-banner fixed top-0 left-0 right-0 z-50 px-4 py-2 text-center text-sm font-medium">
        <i class="fas fa-wifi-slash mr-2"></i> You're offline. Changes will sync when you reconnect.
    </div>

 <!-- Auth Modal -->
<div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
    <div class="bg-white rounded-2xl max-w-md w-full p-8 shadow-2xl">
        <div class="text-center mb-6">
            <div class="w-16 h-16 bg-gradient-to-br from-[#771414] to-[#9f1c1c] rounded-full flex items-center justify-center text-white text-2xl mx-auto mb-4">
                <i class="fas fa-building"></i>
            </div>
            <h2 class="text-2xl font-bold display-font">QLD Pipeline and CRM</h2>
            <p class="text-gray-500 mt-2">All 77 Local Government Areas</p>
        </div>

        <div id="authForm">
            <div class="mb-3">
                <label for="authEmail" class="block text-sm font-medium text-gray-700 mb-1">Email address</label>
                <input type="email" 
                       id="authEmail" 
                       name="email"
                       autocomplete="email" 
                       placeholder="your@email.com" 
                       class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
            </div>
            
            <div class="mb-4">
                <label for="authPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input type="password" 
                       id="authPassword" 
                       name="password"
                       autocomplete="current-password" 
                       placeholder="••••••••" 
                       class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
            </div>

            <button type="button" onclick="signIn()" class="w-full py-3 bg-[#771414] text-white rounded-lg font-medium hover:bg-[#5a1010] transition-colors mb-3">
                Sign In
            </button>

            <div class="relative mb-4">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-300"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                    <span class="px-2 bg-white text-gray-500">or</span>
                </div>
            </div>

            <button onclick="enterDemoMode()" class="w-full py-3 bg-gray-800 text-white rounded-lg font-medium hover:bg-gray-900 transition-colors flex items-center justify-center">
                <i class="fas fa-play-circle mr-2"></i> Continue in Demo Mode
            </button>

            <p class="text-xs text-center text-gray-400 mt-4">
                Demo mode stores data locally on your device. No account required.
            </p>
        </div>
    </div>
</div>
    <!-- Main App (Hidden until auth or demo) -->
    <div id="mainApp" class="hidden">

        <!-- Navigation -->
        <nav class="glass-panel sticky top-0 z-40 border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16 items-center">
                    <div class="flex items-center space-x-4">
                        <div class="w-10 h-10 bg-gradient-to-br from-[#771414] to-[#9f1c1c] rounded-lg flex items-center justify-center text-white font-bold text-xl shadow-lg">
                            QLD
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900 display-font tracking-tight">Business Development & CRM</h1>
                            <div class="flex items-center space-x-2 text-xs text-gray-500">
                                <span id="userEmail"></span>
                                <span id="demoBadge" class="hidden demo-badge">DEMO MODE</span>
                                <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                                <span id="syncStatus" class="flex items-center text-green-600">
                                    <i class="fas fa-check-circle mr-1"></i> Ready
                                </span>
                                <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                                <span class="text-[#771414] font-semibold">77 LGAs</span>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center space-x-4">
                        <!-- Admin Button - Hidden by default -->
                        <button id="adminButton" onclick="showAdminPanel()" class="hidden px-4 py-2 bg-[#771414] text-white rounded-lg hover:bg-[#5a1010] text-sm font-medium transition-colors shadow-sm">
                            <i class="fas fa-shield-alt mr-2"></i> Admin
                        </button>

                        <button onclick="exportToExcel()" class="hidden md:flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors shadow-sm">
                            <i class="fas fa-file-excel mr-2"></i> Export Excel
                        </button>

                        <button onclick="shareReport()" class="hidden md:flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors shadow-sm">
                            <i class="fas fa-share-alt mr-2"></i> Share
                        </button>

                        <button onclick="signOut()" class="px-4 py-2 text-gray-600 hover:text-gray-900 text-sm font-medium">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>

                        <div class="relative">
                            <input type="text" id="globalSearch" placeholder="Search all 77 LGAs..." 
                                   class="pl-10 pr-4 py-2 rounded-full bg-gray-100 border-none focus:ring-2 focus:ring-[#771414] w-56 text-sm"
                                   onkeyup="globalSearch()">
                            <i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Navigation Tabs -->
        <div class="bg-white border-b border-gray-200 sticky top-16 z-30">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8">
                    <button onclick="switchMainTab('tenders')" id="tab-tenders" class="main-tab active py-4 px-2 text-sm font-medium text-gray-600 hover:text-gray-900 flex items-center">
                        <i class="fas fa-file-contract mr-2 text-[#771414]"></i> Tenders & Opportunities
                    </button>
                    <button onclick="switchMainTab('crm')" id="tab-crm" class="main-tab py-4 px-2 text-sm font-medium text-gray-600 hover:text-gray-900 flex items-center">
                        <i class="fas fa-users mr-2 text-blue-600"></i> CRM & Contacts
                    </button>
                    <button onclick="switchMainTab('analytics')" id="tab-analytics" class="main-tab py-4 px-2 text-sm font-medium text-gray-600 hover:text-gray-900 flex items-center">
                        <i class="fas fa-chart-line mr-2 text-green-600"></i> Analytics & Pipeline
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

            <!-- TENDERS TAB CONTENT -->
            <div id="content-tenders" class="main-content">

                <!-- Dashboard Stats -->
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
                    <div class="stat-card rounded-xl p-5 shadow-sm">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs font-medium text-gray-600 mb-1">To Price</p>
                                <h3 class="text-2xl font-bold text-gray-900" id="statToPrice">-</h3>
                            </div>
                            <div class="p-2 bg-blue-50 rounded-lg">
                                <i class="fas fa-calculator text-blue-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card rounded-xl p-5 shadow-sm">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs font-medium text-gray-600 mb-1">Priced</p>
                                <h3 class="text-2xl font-bold text-gray-900" id="statPriced">-</h3>
                            </div>
                            <div class="p-2 bg-green-50 rounded-lg">
                                <i class="fas fa-check-circle text-green-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card rounded-xl p-5 shadow-sm">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs font-medium text-gray-600 mb-1">Not Pricing</p>
                                <h3 class="text-2xl font-bold text-gray-900" id="statNotPricing">-</h3>
                            </div>
                            <div class="p-2 bg-gray-50 rounded-lg">
                                <i class="fas fa-ban text-gray-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card rounded-xl p-5 shadow-sm">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs font-medium text-gray-600 mb-1">Awarded</p>
                                <h3 class="text-2xl font-bold text-gray-900" id="statAwarded">-</h3>
                            </div>
                            <div class="p-2 bg-yellow-50 rounded-lg">
                                <i class="fas fa-trophy text-yellow-600"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Total: <span id="statTotalValue">-</span></p>
                    </div>

                    <div class="stat-card rounded-xl p-5 shadow-sm">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs font-medium text-gray-600 mb-1">Not Won</p>
                                <h3 class="text-2xl font-bold text-gray-900" id="statNotWon">-</h3>
                            </div>
                            <div class="p-2 bg-red-50 rounded-lg">
                                <i class="fas fa-times-circle text-red-600"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Region Selector -->
                <div class="mb-8">
                    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6 gap-4">
                        <div>
                            <h2 class="text-2xl font-bold display-font text-gray-900">Select Region</h2>
                            <p class="text-sm text-gray-500 mt-1">Browse by zone or search all 77 Queensland LGAs</p>
                        </div>

                        <!-- Zone Filter -->
                        <div class="flex flex-wrap gap-2">
                            <button onclick="filterByZone('all')" class="zone-filter px-4 py-2 rounded-full text-sm font-medium bg-[#771414] text-white shadow-md transition-all" data-zone="all">
                                All Zones
                            </button>
                            <button onclick="filterByZone('SEQ')" class="zone-filter px-4 py-2 rounded-full text-sm font-medium bg-white text-gray-600 hover:bg-gray-100 border border-gray-200 transition-all" data-zone="SEQ">
                                South East QLD
                            </button>
                            <button onclick="filterByZone('NQ')" class="zone-filter px-4 py-2 rounded-full text-sm font-medium bg-white text-gray-600 hover:bg-gray-100 border border-gray-200 transition-all" data-zone="NQ">
                                North QLD
                            </button>
                            <button onclick="filterByZone('CQ')" class="zone-filter px-4 py-2 rounded-full text-sm font-medium bg-white text-gray-600 hover:bg-gray-100 border border-gray-200 transition-all" data-zone="CQ">
                                Central QLD
                            </button>
                            <button onclick="filterByZone('SWQ')" class="zone-filter px-4 py-2 rounded-full text-sm font-medium bg-white text-gray-600 hover:bg-gray-100 border border-gray-200 transition-all" data-zone="SWQ">
                                South West QLD
                            </button>
                            <button onclick="filterByZone('FNQ')" class="zone-filter px-4 py-2 rounded-full text-sm font-medium bg-white text-gray-600 hover:bg-gray-100 border border-gray-200 transition-all" data-zone="FNQ">
                                Far North QLD
                            </button>
                            <button onclick="filterByZone('GULF')" class="zone-filter px-4 py-2 rounded-full text-sm font-medium bg-white text-gray-600 hover:bg-gray-100 border border-gray-200 transition-all" data-zone="GULF">
                                Gulf Country
                            </button>
                        </div>
                    </div>

                    <!-- Region Tabs Container -->
                    <div class="region-group rounded-xl p-4 mb-6">
                        <div class="flex space-x-2 overflow-x-auto pb-2 region-scroll" id="regionTabs" style="max-height: 200px; flex-wrap: wrap;">
                            <!-- Tabs injected by JS -->
                        </div>
                    </div>

                    <div id="regionContent" class="space-y-6">
                        <div class="flex items-center justify-center h-64">
                            <div class="loading-skeleton w-full h-full rounded-xl"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CRM TAB CONTENT -->
            <div id="content-crm" class="main-content hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold display-font text-gray-900 mb-2">Customer Relationship Management</h2>
                    <p class="text-gray-600">Manage all your council contacts, suppliers, contractors, and competitors across all 77 LGAs.</p>
                </div>

                <!-- CRM Stats - Updated with Categories -->
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
                    <div class="bg-blue-50 rounded-xl p-5 border border-blue-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-blue-600 font-medium">Total Contacts</p>
                                <h3 class="text-3xl font-bold text-blue-900" id="crmTotalContacts">-</h3>
                            </div>
                            <i class="fas fa-address-book text-blue-400 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-blue-50 rounded-xl p-5 border border-blue-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-blue-600 font-medium">Councils</p>
                                <h3 class="text-2xl font-bold text-blue-900" id="crmCouncils">-</h3>
                            </div>
                            <i class="fas fa-landmark text-blue-400 text-xl"></i>
                        </div>
                    </div>
                    <div class="bg-green-50 rounded-xl p-5 border border-green-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-green-600 font-medium">Suppliers</p>
                                <h3 class="text-2xl font-bold text-green-900" id="crmSuppliers">-</h3>
                            </div>
                            <i class="fas fa-truck text-green-400 text-xl"></i>
                        </div>
                    </div>
                    <div class="bg-orange-50 rounded-xl p-5 border border-orange-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-orange-600 font-medium">Contractors</p>
                                <h3 class="text-2xl font-bold text-orange-900" id="crmContractors">-</h3>
                            </div>
                            <i class="fas fa-hard-hat text-orange-400 text-xl"></i>
                        </div>
                    </div>
                    <div class="bg-red-50 rounded-xl p-5 border border-red-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-red-600 font-medium">Competitors</p>
                                <h3 class="text-2xl font-bold text-red-900" id="crmCompetitors">-</h3>
                            </div>
                            <i class="fas fa-chess text-red-400 text-xl"></i>
                        </div>
                    </div>
                </div>

                <!-- CRM Filters - Updated with Category Filter -->
                <div class="flex flex-col md:flex-row gap-4 mb-6">
                    <div class="flex-1">
                        <input type="text" id="crmSearch" placeholder="Search contacts by name, position, or organization..." 
                               class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none"
                               onkeyup="searchCRM()">
                    </div>
                    <select id="crmCategoryFilter" onchange="filterCRM()" class="px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none bg-white">
                        <option value="all">All Categories</option>
                        <option value="Council">Council</option>
                        <option value="Supplier">Supplier</option>
                        <option value="Contractor">Contractor</option>
                        <option value="Competitor">Competitor</option>
                    </select>
                    <select id="crmRegionFilter" onchange="filterCRM()" class="px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none bg-white">
                        <option value="all">All Regions</option>
                        <!-- Options populated by JS -->
                    </select>
                    <button onclick="showAddCRMModal()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium whitespace-nowrap">
                        <i class="fas fa-plus mr-2"></i> Add Contact
                    </button>
                </div>

                <!-- CRM Contacts List -->
                <div id="crmContactsList" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- ANALYTICS TAB CONTENT -->
            <div id="content-analytics" class="main-content hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold display-font text-gray-900 mb-2">Analytics & Pipeline</h2>
                    <p class="text-gray-600">Track your win rates, pricing performance, and pipeline value across all regions.</p>
                </div>

                <!-- Analytics Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Win Rate Card -->
                    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                        <h3 class="text-lg font-bold mb-4">Win Rate Analysis</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-gray-600">Total Tenders Priced</span>
                                <span class="font-bold text-xl" id="analyticsTotalPriced">0</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                <span class="text-green-700">Won</span>
                                <span class="font-bold text-xl text-green-700" id="analyticsWon">0</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                                <span class="text-red-700">Lost</span>
                                <span class="font-bold text-xl text-red-700" id="analyticsLost">0</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                <span class="text-blue-700">Win Rate</span>
                                <span class="font-bold text-xl text-blue-700" id="analyticsWinRate">0%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Pipeline Value Card -->
                    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                        <h3 class="text-lg font-bold mb-4">Pipeline Value</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                <span class="text-blue-700">To Price</span>
                                <span class="font-bold text-xl text-blue-700" id="analyticsToPriceValue">$0</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                <span class="text-green-700">Priced & Submitted</span>
                                <span class="font-bold text-xl text-green-700" id="analyticsPricedValue">$0</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-yellow-50 rounded-lg">
                                <span class="text-yellow-700">Awarded Value</span>
                                <span class="font-bold text-xl text-yellow-700" id="analyticsAwardedValue">$0</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-purple-50 rounded-lg">
                                <span class="text-purple-700">Total Pipeline</span>
                                <span class="font-bold text-xl text-purple-700" id="analyticsTotalPipeline">$0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Region Performance -->
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                    <h3 class="text-lg font-bold mb-4">Performance by Region</h3>
                    <div id="regionPerformanceList" class="space-y-3">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

        </div>

        <!-- Tender Entry Modal -->
        <div id="tenderModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
            <div class="bg-white rounded-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
                <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center z-10">
                    <h3 class="text-xl font-bold display-font" id="tenderModalTitle">Add New Tender</h3>
                    <button onclick="closeTenderModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <form id="tenderForm" class="p-6 space-y-4" onsubmit="saveTender(event)">
                    <input type="hidden" id="tenderId">
                    <input type="hidden" id="tenderRegion">

                    <div class="grid grid-cols-2 gap-4">
                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Project Title *</label>
                            <input type="text" id="tenderTitle" required class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                            <select id="tenderCategory" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none bg-white">
                                <option value="Infrastructure">Infrastructure</option>
                                <option value="Construction">Construction</option>
                                <option value="Professional Services">Professional Services</option>
                                <option value="IT & Digital">IT & Digital</option>
                                <option value="Environmental">Environmental</option>
                                <option value="Community Services">Community Services</option>
                                <option value="Waste Management">Waste Management</option>
                                <option value="Water & Sewerage">Water & Sewerage</option>
                                <option value="Roads & Transport">Roads & Transport</option>
                                <option value="Parks & Recreation">Parks & Recreation</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Status *</label>
                            <select id="tenderStatus" required onchange="togglePricingFields()" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none bg-white">
                                <option value="TO_PRICE">TO PRICE</option>
                                <option value="PRICED">PRICED</option>
                                <option value="NOT_PRICING">NOT PRICING</option>
                                <option value="AWARDED">AWARDED</option>
                                <option value="NOT_WON">NOT WON</option>
                            </select>
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Estimated Value ($)</label>
                            <input type="text" id="tenderValue" placeholder="$0.00" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Closing Date</label>
                            <input type="date" id="tenderClosingDate" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                        </div>

                        <!-- PRICED Fields -->
                        <div id="pricedFields" class="col-span-2 hidden border-t pt-4 mt-2">
                            <h4 class="font-semibold text-green-700 mb-3 flex items-center">
                                <i class="fas fa-check-circle mr-2"></i> Pricing Details
                            </h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Our Price ($)</label>
                                    <input type="text" id="ourPrice" placeholder="$0.00" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                                </div>
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Submission Date</label>
                                    <input type="date" id="submissionDate" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                                </div>
                            </div>
                        </div>

                        <!-- NOT PRICING Fields -->
                        <div id="notPricingFields" class="col-span-2 hidden border-t pt-4 mt-2">
                            <h4 class="font-semibold text-gray-700 mb-3 flex items-center">
                                <i class="fas fa-ban mr-2"></i> Reason for Not Pricing
                            </h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Reason</label>
                                    <select id="notPricingReason" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none bg-white">
                                        <option value="">Select reason...</option>
                                        <option value="Capacity">At Capacity</option>
                                        <option value="Capability">Outside Capability</option>
                                        <option value="Location">Too Remote</option>
                                        <option value="Value">Too Small/Large</option>
                                        <option value="Conflict">Conflict of Interest</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Comments</label>
                                    <textarea id="notPricingComments" rows="2" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- AWARDED Fields -->
                        <div id="awardedFields" class="col-span-2 hidden border-t pt-4 mt-2">
                            <h4 class="font-semibold text-yellow-700 mb-3 flex items-center">
                                <i class="fas fa-trophy mr-2"></i> Award Details
                            </h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Awarded Date</label>
                                    <input type="date" id="awardedDate" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                                </div>
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Contract Value ($)</label>
                                    <input type="text" id="awardedValue" placeholder="$0.00" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                                </div>
                                <div class="col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Scope Summary</label>
                                    <textarea id="awardedScope" rows="2" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- NOT WON Fields -->
                        <div id="notWonFields" class="col-span-2 hidden border-t pt-4 mt-2">
                            <h4 class="font-semibold text-red-700 mb-3 flex items-center">
                                <i class="fas fa-times-circle mr-2"></i> Competitor Information
                            </h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Who Won?</label>
                                    <input type="text" id="winnerName" placeholder="Company name" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                                </div>
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Their Price ($) (if known)</label>
                                    <input type="text" id="winnerPrice" placeholder="$0.00" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                                </div>
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Our Price ($)</label>
                                    <input type="text" id="ourLosingPrice" placeholder="$0.00" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                                </div>
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Date Announced</label>
                                    <input type="date" id="resultDate" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                                </div>
                                <div class="col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Comments / Lessons Learned</label>
                                    <textarea id="notWonComments" rows="3" placeholder="Why did we lose? What could we do better next time?" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="col-span-2 border-t pt-4 mt-2">
                            <h4 class="font-semibold text-gray-900 mb-3 flex items-center">
                                <i class="fas fa-user-tie mr-2 text-[#771414]"></i> Council Contact Details
                            </h4>
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Contact Name</label>
                            <input type="text" id="tenderContactName" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Position</label>
                            <input type="text" id="tenderContactPosition" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" id="tenderContactEmail" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                            <input type="tel" id="tenderContactPhone" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none">
                        </div>

                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Project Description</label>
                            <textarea id="tenderDescription" rows="3" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-[#771414] focus:outline-none"></textarea>
                        </div>
                        <div class="col-span-2 border-t pt-4 mt-2">
    <h4 class="font-semibold text-purple-900 mb-3 flex items-center">
        <i class="fas fa-comments mr-2 text-purple-600"></i> Comments & History
    </h4>
    
    <!-- Existing Comments Display -->
    <div id="tenderCommentsList" class="space-y-2 mb-4 max-h-40 overflow-y-auto">
        <!-- Populated by JS -->
    </div>
    
    <!-- Add New Comment -->
    <div class="bg-gray-50 rounded-lg p-3">
        <label class="block text-sm font-medium text-gray-700 mb-1">Add Update/Comment</label>
        <textarea id="newTenderComment" rows="2" placeholder="Enter update or comment..." class="w-full rounded-lg px-3 py-2 border-2 border-gray-200 focus:border-purple-500 focus:outline-none text-sm mb-2"></textarea>
        <button type="button" onclick="addTenderComment()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm font-medium">
            <i class="fas fa-plus mr-1"></i> Add Comment
        </button>
    </div>
                    </div>

                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        <button type="button" onclick="closeTenderModal()" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">Cancel</button>
                        <button type="submit" class="px-6 py-2 bg-[#771414] text-white rounded-lg hover:bg-[#5a1010] transition-colors shadow-lg">
                            <i class="fas fa-save mr-2"></i> Save Tender
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- CRM Contact Modal - Updated with Category Field -->
        <div id="crmModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
            <div class="bg-white rounded-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
                <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center z-10">
                    <h3 class="text-xl font-bold display-font" id="crmModalTitle">Add CRM Contact</h3>
                    <button onclick="closeCRMModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="crmForm" class="p-6 space-y-4" onsubmit="saveCRM(event)">
                    <input type="hidden" id="crmContactId">

                    <div class="grid grid-cols-2 gap-4">
                        <!-- Category Field - NEW -->
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                            <select id="crmCategory" required onchange="handleCategoryChange()" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none bg-white">
                                <option value="Council">Council (LGA)</option>
                                <option value="Supplier">Supplier</option>
                                <option value="Contractor">Contractor</option>
                                <option value="Competitor">Competitor</option>
                            </select>
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Region</label>
                            <select id="crmRegion" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none bg-white">
                                <option value="">Select Region...</option>
                                <!-- Populated by JS -->
                            </select>
                            <p class="text-xs text-gray-500 mt-1" id="regionHelp">Required for Council contacts</p>
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Contact Type</label>
                            <select id="crmType" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none bg-white">
                                <option value="Procurement">Procurement</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Management">Management</option>
                                <option value="Elected">Elected Member</option>
                                <option value="Operations">Operations</option>
                                <option value="Sales">Sales</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                            <input type="text" id="crmName" required class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none">
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Position/Title *</label>
                            <input type="text" id="crmPosition" required class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none">
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Organization/Company</label>
                            <input type="text" id="crmDepartment" placeholder="e.g., Brisbane City Council, Acme Supplies Pty Ltd" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none">
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Direct Phone</label>
                            <input type="tel" id="crmDirectPhone" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none">
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Mobile</label>
                            <input type="tel" id="crmMobile" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none">
                        </div>

                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                            <input type="email" id="crmEmail" required class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none">
                        </div>

                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">LinkedIn Profile</label>
                            <input type="url" id="crmLinkedIn" placeholder="https://linkedin.com/in/ ..." class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none">
                        </div>

                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Relationship Notes</label>
                            <textarea id="crmNotes" rows="3" placeholder="How did you meet? Interests, family, preferences..." class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none"></textarea>
                        </div>

                        <div class="col-span-2 border-t pt-4 mt-2">
                            <h4 class="font-semibold text-blue-900 mb-3 flex items-center">
                                <i class="fas fa-clock mr-2"></i> Last Interaction
                            </h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                    <input type="date" id="crmLastContactDate" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none">
                                </div>
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                    <select id="crmLastContactType" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none bg-white">
                                        <option value="">Select...</option>
                                        <option value="Meeting">Meeting</option>
                                        <option value="Phone">Phone Call</option>
                                        <option value="Email">Email</option>
                                        <option value="Event">Industry Event</option>
                                        <option value="Tender">Tender Discussion</option>
                                    </select>
                                </div>
                                <div class="col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Notes from Last Contact</label>
                                    <textarea id="crmLastContactNotes" rows="2" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="col-span-2 border-t pt-4 mt-2">
                            <h4 class="font-semibold text-orange-900 mb-3 flex items-center">
                                <i class="fas fa-bell mr-2"></i> Follow-up Reminder
                            </h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Next Follow-up Date</label>
                                    <input type="date" id="crmFollowUpDate" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none">
                                </div>
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                                    <select id="crmPriority" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none bg-white">
                                        <option value="High">High</option>
                                        <option value="Medium" selected>Medium</option>
                                        <option value="Low">Low</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        <button type="button" onclick="closeCRMModal()" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">Cancel</button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-lg">
                            <i class="fas fa-save mr-2"></i> Save Contact
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Interaction Modal -->
        <div id="interactionModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
            <div class="bg-white rounded-2xl max-w-lg w-full shadow-2xl">
                <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center z-10">
                    <h3 class="text-xl font-bold display-font">Add Interaction</h3>
                    <button onclick="closeInteractionModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <form id="interactionForm" class="p-6 space-y-4" onsubmit="saveInteraction(event)">
                    <input type="hidden" id="interactionContactId">

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Date *</label>
                        <input type="date" id="interactionDate" required class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Type *</label>
                        <select id="interactionType" required class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none bg-white">
                            <option value="Meeting">Meeting</option>
                            <option value="Phone">Phone Call</option>
                            <option value="Email">Email</option>
                            <option value="Video">Video Call</option>
                            <option value="Event">Industry Event</option>
                            <option value="Site Visit">Site Visit</option>
                            <option value="Tender Discussion">Tender Discussion</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notes *</label>
                        <textarea id="interactionNotes" required rows="4" placeholder="What was discussed? Any action items?" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Next Steps</label>
                        <input type="text" id="interactionNextSteps" placeholder="Any follow-up required?" class="w-full rounded-lg px-4 py-2 border-2 border-gray-200 focus:border-blue-500 focus:outline-none">
                    </div>

                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        <button type="button" onclick="closeInteractionModal()" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">Cancel</button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-lg">
                            <i class="fas fa-plus mr-2"></i> Add Interaction
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Admin Panel Modal -->
        <div id="adminPanel" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
            <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
                <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center z-10">
                    <h3 class="text-xl font-bold display-font flex items-center">
                        <i class="fas fa-shield-alt mr-2 text-[#771414]"></i> Admin Approval Panel
                    </h3>
                    <button onclick="closeAdminPanel()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <div class="p-6">
                    <div class="mb-6">
                        <h4 class="font-semibold text-gray-900 mb-2">Pending Approval Requests</h4>
                        <p class="text-sm text-gray-500">Review and approve new user registrations</p>
                    </div>

                    <div id="pendingApprovalsList" class="space-y-4">
                        <div class="text-center py-8 text-gray-400">
                            <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                            <p>Loading requests...</p>
                        </div>
                    </div>

                    <div class="mt-8 pt-6 border-t">
                        <h4 class="font-semibold text-gray-900 mb-2">Approved Users</h4>
                        <div id="approvedUsersList" class="space-y-2">
                            <div class="text-center py-4 text-gray-400">
                                <p>Loading approved users...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div id="toastContainer" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

        <!-- Quick Actions -->
        <div class="fixed bottom-8 right-8 flex flex-col space-y-3">
            <button onclick="quickAdd()" class="w-14 h-14 bg-[#771414] text-white rounded-full shadow-lg hover:shadow-xl transform hover:scale-110 transition-all flex items-center justify-center group relative">
                <i class="fas fa-plus text-xl"></i>
                <span class="absolute right-16 bg-gray-900 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">Quick Add</span>
            </button>
        </div>
    </div>
<!-- Add this in the <head> section, BEFORE your other scripts -->
<script>
// ==================== GLOBAL VARIABLES ====================
let currentUser = null;
let isDemoMode = false;
let currentRegion = null;
let currentMainTab = 'tenders';
let database = {
    tenders: [],
    crmContacts: [],
    interactions: []
};

// Safe Currency Parsing Functions
function parseCurrency(value) {
    if (!value || typeof value !== 'string') return 0;
    const cleaned = value.replace(/[^0-9.]/g, '');
    if (!cleaned || cleaned === '.') return 0;
    const parsed = parseFloat(cleaned);
    return isNaN(parsed) ? 0 : parsed;
}

function sumValues(tenders) {
    if (!Array.isArray(tenders)) return 0;
    return tenders.reduce((sum, t) => {
        const val = parseCurrency(t?.value);
        return sum + val;
    }, 0);
}

function formatCurrency(value) {
    const num = parseFloat(value) || 0;
    if (num >= 1000000) {
        return '$' + (num / 1000000).toFixed(1) + 'M';
    } else if (num >= 1000) {
        return '$' + (num / 1000).toFixed(0) + 'K';
    }
    return '$' + num.toFixed(0);
}

function formatDate(dateStr) {
    if (!dateStr) return '';
    try {
        const date = new Date(dateStr);
        if (isNaN(date.getTime())) return '';
        if (date.getFullYear() < 2000 || date.getFullYear() > 2100) return '';
        return date.toLocaleDateString('en-AU', { 
            day: 'numeric', 
            month: 'short', 
            year: 'numeric' 
        });
    } catch (e) {
        console.warn('Date formatting error:', e);
        return '';
    }
}

function formatDateForInput(dateStr) {
    if (!dateStr) return '';
    try {
        const date = new Date(dateStr);
        if (isNaN(date.getTime())) return '';
        return date.toISOString().split('T')[0];
    } catch (e) {
        return '';
    }
}

// Queensland Regions Data (77 LGAs)
const qldRegions = [
    // SOUTH EAST QUEENSLAND (SEQ) - 17 LGAs
    { id: 'SEQ-BCC', name: 'Brisbane City Council', zone: 'SEQ' },
    { id: 'SEQ-GC', name: 'Gold Coast City', zone: 'SEQ' },
    { id: 'SEQ-ISC', name: 'Ipswich City', zone: 'SEQ' },
    { id: 'SEQ-LCC', name: 'Logan City', zone: 'SEQ' },
    { id: 'SEQ-MRCC', name: 'Moreton Bay Regional', zone: 'SEQ' },
    { id: 'SEQ-RCC', name: 'Redland City', zone: 'SEQ' },
    { id: 'SEQ-SCRC', name: 'Sunshine Coast Regional', zone: 'SEQ' },
    { id: 'SEQ-TRC', name: 'Toowoomba Regional', zone: 'SEQ' },
    { id: 'SEQ-LS', name: 'Lockyer Valley Regional', zone: 'SEQ' },
    { id: 'SEQ-SC', name: 'Scenic Rim Regional', zone: 'SEQ' },
    { id: 'SEQ-SB', name: 'Somerset Regional', zone: 'SEQ' },
    { id: 'SEQ-SRC', name: 'Southern Downs Regional', zone: 'SEQ' },
    { id: 'SEQ-WRC', name: 'Western Downs Regional', zone: 'SEQ' },
    { id: 'SEQ-GRC', name: 'Goondiwindi Regional', zone: 'SEQ' },
    { id: 'SEQ-SBRC', name: 'South Burnett Regional', zone: 'SEQ' },
    { id: 'SEQ-NBRC', name: 'North Burnett Regional', zone: 'SEQ' },
    { id: 'SEQ-CRC', name: 'Cherbourg Aboriginal Shire', zone: 'SEQ' },
    
    // NORTH QUEENSLAND (NQ) - 16 LGAs
    { id: 'NQ-TC', name: 'Townsville City', zone: 'NQ' },
    { id: 'NQ-CC', name: 'Cairns Regional', zone: 'NQ' },
    { id: 'NQ-MRC', name: 'Mackay Regional', zone: 'NQ' },
    { id: 'NQ-RRC', name: 'Rockhampton Regional', zone: 'NQ' },
    { id: 'NQ-WRC', name: 'Whitsunday Regional', zone: 'NQ' },
    { id: 'NQ-BS', name: 'Burdekin Shire', zone: 'NQ' },
    { id: 'NQ-HS', name: 'Hinchinbrook Shire', zone: 'NQ' },
    { id: 'NQ-ICC', name: 'Isaac Regional', zone: 'NQ' },
    { id: 'NQ-BC', name: 'Bowen Shire', zone: 'NQ' },
    { id: 'NQ-CH', name: 'Central Highlands Regional', zone: 'NQ' },
    { id: 'NQ-WC', name: 'Winton Shire', zone: 'NQ' },
    { id: 'NQ-FC', name: 'Flinders Shire', zone: 'NQ' },
    { id: 'NQ-RM', name: 'Richmond Shire', zone: 'NQ' },
    { id: 'NQ-MC', name: 'McKinlay Shire', zone: 'NQ' },
    { id: 'NQ-CAR', name: 'Carpentaria Shire', zone: 'NQ' },
    { id: 'NQ-CRO', name: 'Croydon Shire', zone: 'NQ' },
    
    // CENTRAL QUEENSLAND (CQ) - 6 LGAs
    { id: 'CQ-BRC', name: 'Bundaberg Regional', zone: 'CQ' },
    { id: 'CQ-GRC', name: 'Gladstone Regional', zone: 'CQ' },
    { id: 'CQ-GV', name: 'Gympie Regional', zone: 'CQ' },
    { id: 'CQ-FCRC', name: 'Fraser Coast Regional', zone: 'CQ' },
    { id: 'CQ-BAN', name: 'Banana Shire', zone: 'CQ' },
    
    // SOUTH WEST QUEENSLAND (SWQ) - 10 LGAs
    { id: 'SWQ-WRC', name: 'Western Downs Regional', zone: 'SWQ' },
    { id: 'SWQ-MC', name: 'Maranoa Regional', zone: 'SWQ' },
    { id: 'SWQ-BS', name: 'Balonne Shire', zone: 'SWQ' },
    { id: 'SWQ-BM', name: 'Bulloo Shire', zone: 'SWQ' },
    { id: 'SWQ-MU', name: 'Murweh Shire', zone: 'SWQ' },
    { id: 'SWQ-PA', name: 'Paroo Shire', zone: 'SWQ' },
    { id: 'SWQ-QU', name: 'Quilpie Shire', zone: 'SWQ' },
    { id: 'SWQ-BA', name: 'Barcoo Shire', zone: 'SWQ' },
    { id: 'SWQ-BO', name: 'Boulia Shire', zone: 'SWQ' },
    { id: 'SWQ-DI', name: 'Diamantina Shire', zone: 'SWQ' },
    
    // FAR NORTH QUEENSLAND (FNQ) - 19 LGAs
    { id: 'FNQ-TC', name: 'Tablelands Regional', zone: 'FNQ' },
    { id: 'FNQ-MC', name: 'Mareeba Shire', zone: 'FNQ' },
    { id: 'FNQ-DT', name: 'Douglas Shire', zone: 'FNQ' },
    { id: 'FNQ-CC', name: 'Cassowary Coast Regional', zone: 'FNQ' },
    { id: 'FNQ-AP', name: 'Aurukun Shire', zone: 'FNQ' },
    { id: 'FNQ-CK', name: 'Cook Shire', zone: 'FNQ' },
    { id: 'FNQ-EA', name: 'Etheridge Shire', zone: 'FNQ' },
    { id: 'FNQ-HP', name: 'Hope Vale Aboriginal Shire', zone: 'FNQ' },
    { id: 'FNQ-KO', name: 'Kowanyama Aboriginal Shire', zone: 'FNQ' },
    { id: 'FNQ-LP', name: 'Lockhart River Aboriginal Shire', zone: 'FNQ' },
    { id: 'FNQ-MP', name: 'Mapoon Aboriginal Shire', zone: 'FNQ' },
    { id: 'FNQ-NP', name: 'Napranum Aboriginal Shire', zone: 'FNQ' },
    { id: 'FNQ-NL', name: 'Northern Peninsula Area Regional', zone: 'FNQ' },
    { id: 'FNQ-PO', name: 'Pormpuraaw Aboriginal Shire', zone: 'FNQ' },
    { id: 'FNQ-TH', name: 'Torres Shire', zone: 'FNQ' },
    { id: 'FNQ-TI', name: 'Torres Strait Island Regional', zone: 'FNQ' },
    { id: 'FNQ-WC', name: 'Wujal Wujal Aboriginal Shire', zone: 'FNQ' },
    { id: 'FNQ-YA', name: 'Yarrabah Aboriginal Shire', zone: 'FNQ' },
    
    // GULF COUNTRY - 4 LGAs
    { id: 'GULF-BS', name: 'Burke Shire', zone: 'GULF' },
    { id: 'GULF-DO', name: 'Doomadgee Aboriginal Shire', zone: 'GULF' },
    { id: 'GULF-GC', name: 'Gregory Shire', zone: 'GULF' }
];

// ==================== AUTHENTICATION FUNCTIONS ====================

function signIn() {
    const email = document.getElementById('authEmail').value.trim();
    const password = document.getElementById('authPassword').value;
    
    console.log("Login attempt:", email);
    
    if (!email || !password) {
        showToast('Please enter email and password', 'error');
        return;
    }

    auth.signInWithEmailAndPassword(email, password)
        .then(async (userCredential) => {
            currentUser = userCredential.user;
            console.log("Login successful:", currentUser.email);
            console.log("User UID:", currentUser.uid);
            
            try {
                // Check if user is approved
                const approvedDoc = await db.collection('approvedUsers').doc(currentUser.uid).get();
                
                if (!approvedDoc.exists || !approvedDoc.data().approved) {
                    console.log("User not approved, signing out...");
                    await auth.signOut();
                    currentUser = null;
                    showToast('Your account is not authorized. Contact admin.', 'error');
                    return;
                }
                
                // SUCCESS - Hide auth modal and show main app
                console.log("User approved, showing main app...");
                document.getElementById('authModal').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('userEmail').textContent = currentUser.email;
                
                // Load data from Firestore
                await initializeDatabase();
                
                // Check if user is admin
                await checkAdminStatus();
                
                showToast('Welcome back!', 'success');
                
            } catch (error) {
                console.error("Approval check error:", error);
                showToast('Error checking account status: ' + error.message, 'error');
                await auth.signOut();
                currentUser = null;
            }
        })
        .catch((error) => {
            console.error("Firebase Auth Error:", error.code, error.message);
            
            let errorMessage = error.message;
            if (error.code === 'auth/user-not-found') {
                errorMessage = 'No account found with this email.';
            } else if (error.code === 'auth/wrong-password') {
                errorMessage = 'Incorrect password.';
            } else if (error.code === 'auth/invalid-email') {
                errorMessage = 'Please enter a valid email address.';
            } else if (error.code === 'auth/invalid-credential') {
                errorMessage = 'Invalid email or password.';
            } else if (error.code === 'auth/too-many-requests') {
                errorMessage = 'Too many failed attempts. Please try again later.';
            }
            
            showToast('Login failed: ' + errorMessage, 'error');
        });
}

// Listen for auth state changes
auth.onAuthStateChanged((user) => {
    if (user) {
        console.log("Auth state: User signed in", user.email);
        // Don't auto-show app here - let signIn() handle the approval check
    } else {
        console.log("Auth state: No user signed in");
        currentUser = null;
        document.getElementById('authModal').classList.remove('hidden');
        document.getElementById('mainApp').classList.add('hidden');
    }
});

function enterDemoMode() {
    isDemoMode = true;
    currentUser = { uid: 'demo', email: 'demo@local' };
    
    document.getElementById('authModal').classList.add('hidden');
    document.getElementById('mainApp').classList.remove('hidden');
    document.getElementById('demoBadge').classList.remove('hidden');
    document.getElementById('userEmail').textContent = 'Demo Mode';
    
    const saved = localStorage.getItem('qldCrmDemoData');
    if (saved) {
        database = JSON.parse(saved);
    }
    
    initializeUI();
    updateSyncStatus('Demo Mode');
}

function signOut() {
    if (isDemoMode) {
        isDemoMode = false;
        currentUser = null;
        database = { tenders: [], crmContacts: [], interactions: [] };
    } else {
        auth.signOut();
        currentUser = null;
    }
    
    document.getElementById('mainApp').classList.add('hidden');
    document.getElementById('authModal').classList.remove('hidden');
    document.getElementById('demoBadge').classList.add('hidden');
    document.getElementById('adminButton').classList.add('hidden');
}

async function checkIfAdmin() {
    if (isDemoMode) return false;
    if (!currentUser) return false;
    
    try {
        const adminDoc = await db.collection('admins').doc(currentUser.uid).get();
        console.log("Admin check:", adminDoc.exists);
        return adminDoc.exists;
    } catch (error) {
        console.error("Error checking admin status:", error);
        return false;
    }
}

async function checkAdminStatus() {
    try {
        const isAdmin = await checkIfAdmin();
        const adminButton = document.getElementById('adminButton');
        if (isAdmin) {
            adminButton.classList.remove('hidden');
            console.log("Admin button shown");
        } else {
            adminButton.classList.add('hidden');
        }
    } catch (error) {
        console.error("Error in checkAdminStatus:", error);
    }
}

// ==================== DATABASE FUNCTIONS ====================

async function initializeDatabase() {
    if (isDemoMode) return;
    
    try {
        updateSyncStatus('Loading...');
        
        // Load tenders
        const tendersSnapshot = await db.collection('tenders').get();
        database.tenders = tendersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        
        // Load CRM contacts
        const contactsSnapshot = await db.collection('crmContacts').get();
        database.crmContacts = contactsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        
        // Load interactions
        const interactionsSnapshot = await db.collection('interactions').get();
        database.interactions = interactionsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        
        initializeUI();
        updateSyncStatus('Synced');
    } catch (error) {
        console.error('Error loading data:', error);
        showToast('Error loading data', 'error');
        updateSyncStatus('Error');
    }
}

async function saveData() {
    if (isDemoMode) {
        localStorage.setItem('qldCrmDemoData', JSON.stringify(database));
        return;
    }
    
    updateSyncStatus('Syncing...');
    
    try {
        // Save all tenders to Firestore
        for (const tender of database.tenders) {
            const tenderRef = db.collection('tenders').doc(String(tender.id));
            await tenderRef.set(tender);
        }
        
        // Save all contacts to Firestore
        for (const contact of database.crmContacts) {
            const contactRef = db.collection('crmContacts').doc(String(contact.id));
            await contactRef.set(contact);
        }
        
        // Save all interactions to Firestore
        for (const interaction of database.interactions) {
            const interactionRef = db.collection('interactions').doc(String(interaction.id));
            await interactionRef.set(interaction);
        }
        
        updateSyncStatus('Synced');
        console.log('Data saved to Firebase');
    } catch (error) {
        console.error('Error saving data:', error);
        updateSyncStatus('Error');
        showToast('Error saving data: ' + error.message, 'error');
        throw error;
    }
}

// ==================== UI INITIALIZATION ====================

function initializeUI() {
    renderRegionTabs();
    populateRegionFilters();
    loadRegion(qldRegions[0].id);
    updateAllStats();
}

function renderRegionTabs() {
    const container = document.getElementById('regionTabs');
    
    container.innerHTML = qldRegions.map(region => `
        <button onclick="loadRegion('${region.id}')" 
                class="region-tab px-4 py-2 rounded-lg text-sm font-medium bg-white border border-gray-200 hover:bg-gray-50 transition-all whitespace-nowrap"
                data-region="${region.id}"
                data-zone="${region.zone}">
            ${region.name}
        </button>
    `).join('');
}

function populateRegionFilters() {
    const regionSelects = ['crmRegion', 'crmRegionFilter', 'tenderRegion'];
    
    regionSelects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (!select) return;
        
        const firstOption = select.options[0];
        select.innerHTML = '';
        select.appendChild(firstOption);
        
        qldRegions.forEach(region => {
            const option = document.createElement('option');
            option.value = region.id;
            option.textContent = region.name;
            select.appendChild(option);
        });
    });
}

function filterByZone(zone) {
    document.querySelectorAll('.zone-filter').forEach(btn => {
        if (btn.dataset.zone === zone) {
            btn.classList.add('active');
            btn.classList.remove('bg-white', 'text-gray-600');
        } else {
            btn.classList.remove('active');
            btn.classList.add('bg-white', 'text-gray-600');
        }
    });
    
    document.querySelectorAll('.region-tab').forEach(tab => {
        if (zone === 'all' || tab.dataset.zone === zone) {
            tab.style.display = 'block';
        } else {
            tab.style.display = 'none';
        }
    });
}

// ==================== MAIN TAB SWITCHING ====================

function switchMainTab(tab) {
    currentMainTab = tab;
    
    document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
    document.getElementById('tab-' + tab).classList.add('active');
    
    document.querySelectorAll('.main-content').forEach(c => c.classList.add('hidden'));
    document.getElementById('content-' + tab).classList.remove('hidden');
    
    if (tab === 'tenders') {
        loadRegion(currentRegion || qldRegions[0].id);
    } else if (tab === 'crm') {
        renderCRMContacts();
    } else if (tab === 'analytics') {
        renderAnalytics();
    }
}

// ==================== TENDER FUNCTIONS ====================

function loadRegion(regionId) {
    currentRegion = regionId;
    
    document.querySelectorAll('.region-tab').forEach(tab => {
        if (tab.dataset.region === regionId) {
            tab.classList.add('bg-[#771414]', 'text-white');
            tab.classList.remove('bg-white', 'text-gray-600');
        } else {
            tab.classList.remove('bg-[#771414]', 'text-white');
            tab.classList.add('bg-white', 'text-gray-600');
        }
    });
    
    const region = qldRegions.find(r => r.id === regionId);
    const regionTenders = database.tenders.filter(t => t.regionId === regionId);
    
    document.getElementById('regionContent').innerHTML = `
        <div class="glass-panel rounded-2xl p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h2 class="text-2xl font-bold display-font text-gray-900">${region.name}</h2>
                    <p class="text-sm text-gray-500 mt-1">${regionTenders.length} tenders</p>
                </div>
                <button onclick="showAddTenderModal('${regionId}')" class="px-4 py-2 bg-[#771414] text-white rounded-lg hover:bg-[#5a1010] transition-colors">
                    <i class="fas fa-plus mr-2"></i> Add Tender
                </button>
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            ${regionTenders.map(tender => renderTenderCard(tender)).join('')}
        </div>
        
        ${regionTenders.length === 0 ? `
        <div class="text-center py-12 text-gray-400">
            <i class="fas fa-inbox text-4xl mb-3"></i>
            <p>No tenders for this region yet</p>
        </div>
        ` : ''}
    `;
}

function renderTenderCard(tender) {
    const statusColors = {
        'TO_PRICE': 'status-to-price',
        'PRICED': 'status-priced',
        'NOT_PRICING': 'status-not-pricing',
        'AWARDED': 'bg-yellow-100 text-yellow-800',
        'NOT_WON': 'bg-red-100 text-red-800'
    };
    
    const commentCount = tender.comments?.length || 0;
    
    return `
    <div class="region-card rounded-xl p-5 shadow-sm card-hover relative group">
        <div class="flex justify-between items-start mb-3">
            <span class="text-xs font-semibold px-2 py-1 rounded ${statusColors[tender.status] || 'bg-gray-100'}">
                ${tender.status.replace('_', ' ')}
            </span>
            <div class="flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity">
                <button onclick="event.stopPropagation(); editTender(${tender.id})" class="p-1 text-blue-600 hover:bg-blue-50 rounded" title="Edit">
                    <i class="fas fa-edit"></i>
                </button>
                <button onclick="event.stopPropagation(); deleteTender(${tender.id})" class="p-1 text-red-600 hover:bg-red-50 rounded" title="Delete">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
            <span class="text-xs text-gray-500">${tender.category}</span>
        </div>
        <h3 class="font-bold text-gray-900 mb-2 line-clamp-2 cursor-pointer" onclick="editTender(${tender.id})">${tender.title}</h3>
        <div class="text-sm text-gray-600 mb-2">${tender.value || 'No value set'}</div>
        <div class="flex justify-between items-center">
            ${tender.closingDate ? `<div class="text-xs text-gray-500"><i class="fas fa-calendar mr-1"></i> ${formatDate(tender
</script>
</body>
</html>




















